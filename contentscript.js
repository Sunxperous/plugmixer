// Generated by CoffeeScript 1.7.1
'use strict';
var indicator, inject;

inject = document.createElement('script');

inject.src = chrome.extension.getURL('mix.js');

(document.head || document.documentElement).appendChild(inject);

indicator = null;

chrome.storage.sync.get('indicator', function(data) {
  indicator = data['indicator'];
  if (indicator !== 'interfacebutton') {
    return chrome.runtime.sendMessage("plugmixer_inactive_icon");
  }
});

chrome.runtime.onMessage.addListener(function(message, sender, sendResponseTo) {
  if (message === 'icon_clicked') {
    return window.postMessage({
      method: 'plugmixer_icon_clicked'
    }, '*');
  }
});

window.addEventListener("message", function(event) {
  if (event.source !== window) {
    return;
  }
  if (event.data.method) {
    switch (event.data.method) {
      case 'plugmixer_save_playlists':
        return chrome.storage.sync.set({
          'playlists': event.data.playlists
        });
      case 'plugmixer_status_change':
        chrome.storage.sync.set({
          'status': event.data.status
        });
        if (indicator !== 'interfacebutton') {
          if (event.data.status) {
            return chrome.runtime.sendMessage("plugmixer_active_icon");
          } else {
            return chrome.runtime.sendMessage("plugmixer_inactive_icon");
          }
        }
        break;
      case 'plugmixer_load_request':
        return chrome.storage.sync.get(['playlists', 'status', 'indicator'], function(data) {
          window.postMessage({
            method: 'plugmixer_load_response',
            playlists: data['playlists'],
            status: data['status'],
            indicator: data['indicator']
          }, '*');
          if (data.status && indicator !== 'interfacebutton') {
            return chrome.runtime.sendMessage("plugmixer_active_icon");
          }
        });
    }
  }
});
